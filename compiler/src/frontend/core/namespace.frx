import "std/libc.frx";

namespace core
{
    export struct Namespace
    {
        char* name;
        core::Namespace* parent;
    }
}

export core::Namespace* namespace_create(core::Namespace* parent, char* name)
{
    mut core::Namespace* ns = libc::malloc(frx::sizeof(core::Namespace));

    ns->name = name;
    ns->parent = parent;

    return ns;
}

export void namespace_destroy(core::Namespace* ns)
{
    if(ns == nullptr)
    {
        return;
    }

    namespace_destroy(ns->parent);
    libc::free(ns);
}

export b8 namespace_is_subset_of(core::Namespace* child, core::Namespace* parent)
{
    if(child == nullptr)
    {
        return true;
    }

    if(parent == nullptr)
    {
        return false;
    }

    mut core::Namespace* child_iter = child;
    mut core::Namespace* parent_iter  = parent;

    while(child_iter != nullptr && parent_iter != nullptr)
    {
        if(libc::strcmp(child_iter->name, parent_iter->name) != 0)
        {
            return false;
        }

        child_iter = child_iter->parent;
        parent_iter = parent_iter->parent;
    }

    return child_iter == nullptr;
}

export b8 namespace_equals(core::Namespace* left, core::Namespace* right)
{
    if(left == nullptr && right == nullptr)
    {
        return true;
    }

    if(left == nullptr && right != nullptr)
    {
        return false;
    }

    if(left != nullptr && right == nullptr)
    {
        return false;
    }

    if(libc::strcmp(left->name, right->name) != 0)
    {
        return false;
    }

    return namespace_equals(left->parent, right->parent);
}

export b8 namespace_is_global(core::Namespace* ns)
{
    return ns == nullptr;
}

export b8 namespace_is_internal(core::Namespace* ns)
{
    return ns != nullptr && libc::strcmp(ns->name, "frx") == 0
        && namespace_is_global(ns->parent);
}
