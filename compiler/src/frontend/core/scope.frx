import "std/libc.frx";

export struct CoreScope
{
    CoreScope* parent;
    usize id;
}

mut usize next_scope_id;

export CoreScope* scope_create(CoreScope* parent)
{
    mut CoreScope* scope = libc_malloc(frx::sizeof(CoreScope));

    scope->parent = parent;
    scope->id = next_scope_id;

    next_scope_id = next_scope_id + 1;

    return scope;
}

export b8 scope_is_global(CoreScope* scope)
{
    return scope != nullptr && scope->parent == nullptr;
}

export b8 scope_is_child_of(CoreScope* child, CoreScope* parent)
{
    frx::assert(child != nullptr && parent != nullptr);

    if(child->id == parent->id)
    {
        return true;
    }

    if(child->parent == nullptr)
    {
        return false;
    }

    return scope_is_child_of(child->parent, parent);
}

export b8 scope_same_root(mut CoreScope* left, mut CoreScope* right)
{
    frx::assert(left != nullptr);

    frx::assert(right != nullptr);

    while(left->parent != nullptr)
    {
        left = left->parent;
    }

    while(right->parent != nullptr)
    {
        right = right->parent;
    }

    return left->id == right->id;
}
