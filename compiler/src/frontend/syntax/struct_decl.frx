export import "../ast/struct_decl.frx";
import "../core/namespace.frx";
import "../core/parser.frx";
import "../core/scope.frx";
import "../symbols/struct.frx";
import "../../core/symbol_table.frx";

export StructDecl* struct_decl_parse(Parser* parser)
{
    frx::assert(parser != nullptr);

    SourceLocation start = parser_current_location(parser);

    parser_eat(parser, TokenType::KW_EXTERN);

    parser_eat(parser, TokenType::KW_STRUCT);

    char* name = parser->token->identifier;

    mut StructDecl* struct_decl = struct_decl_new(&parser->arena, parser->current_scope,
            nullptr, name);

    StructSymbol* symbol = &struct_decl->symbol;
    symbol_table_insert(&parser->module->symbol_table, SymbolType::STRUCT, symbol->name, symbol->exported, symbol);

    parser_eat(parser, TokenType::IDENTIFIER);

    parser_eat(parser, TokenType::SEMICOLON);

    struct_decl->range.start = start;
    struct_decl->range.end = parser_current_location(parser);

    return struct_decl;
}
