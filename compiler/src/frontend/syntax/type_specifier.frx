export void parse_array_dimensions(Parser* parser, ASTTypeSpecifier* type)
{
    assert(parser != nullptr);

    assert(type != nullptr);

    while(parser->token->type == TOKEN_TYPE_LBRACKET)
    {
        parser_eat(parser, TOKEN_TYPE_LBRACKET);
        list_push(&type->array_dimensions, parse_expr(parser));
        parser_eat(parser, TOKEN_TYPE_RBRACKET);
    }
}

export struct ASTTypeSpecifier
{
    Namespace* ns;
    char* name;
    Scope* scope;

    TokenType primitive_type;
    EnumSymbol* enum_type;
    StructSymbol* struct_type;

    usize pointer_level;

    List array_dimensions;
}

export ASTTypeSpecifier* make_type_specifier(Arena* arena, Namespace* ns,
    char* name, Scope* scope, TokenType primitive_type, usize pointer_level)
{
    assert(name != nullptr || primitive_type != TOKEN_TYPE_ERROR);

    assert(scope != nullptr);

    ASTTypeSpecifier* type_specifier = arena_alloc(arena,
        sizeof(ASTTypeSpecifier));

    type_specifier->ns = ns;
    type_specifier->name = name;
    type_specifier->scope = scope;
    type_specifier->primitive_type = primitive_type;
    type_specifier->enum_type = nullptr;
    type_specifier->struct_type = nullptr;
    type_specifier->pointer_level = pointer_level;
    list_init(&type_specifier->array_dimensions);

    return type_specifier;
}

export ASTTypeSpecifier* parse_type_specifier(Parser* parser)
{
    assert(parser != nullptr);

    Namespace* ns = nullptr;
    char* name = nullptr;
    TokenType primitive_type = TOKEN_TYPE_ERROR;

    if(token_type_is_primitive(parser->token->type))
    {
        primitive_type = parser->token->type;

        parser_eat(parser, parser->token->type);
    }
    else
    {
        ns = parse_namespace_resolution(parser);
        name = parser->token->identifier;

        parser_eat(parser, TOKEN_TYPE_IDENTIFIER);
    }

    usize pointer_level = 0;

    while(parser->token->type == TOKEN_TYPE_STAR)
    {
        pointer_level = pointer_level + 1;

        parser_eat(parser, TOKEN_TYPE_STAR);
    }

    ASTTypeSpecifier* type_specifier = make_type_specifier(&parser->arena, ns,
        name, parser->current_scope, primitive_type, pointer_level);

    return type_specifier;
}

void print_type_specifier(ASTTypeSpecifier* type_specifier, FILE* file,
    usize depth)
{
    assert(type_specifier != nullptr);

    assert(file != nullptr);

    print_ast_depth(file, depth);

    fprintf(file, "%s\n", ast_type_to_str(AST_TYPE_TYPE_SPECIFIER));

    print_ast_depth(file, depth + 1);

    fprintf(file, "type: ");
    if(type_specifier->primitive_type != 0)
    {
        fprintf(file, "%s", token_type_to_str(type_specifier->primitive_type));
    }
    else
    {
        print_namespace_resolution(file, type_specifier->ns);
        fprintf(file, "%s", type_specifier->name);
    }

    fprintf(file, "\n");

    print_ast_depth(file, depth + 1);

    fprintf(file, "pointer_level: %zu\n", type_specifier->pointer_level);

    print_ast_depth(file, depth + 1);

    fprintf(file, "array-dimensions\n");

    usize i;
    for(i = 0; i < list_size(&type_specifier->array_dimensions); i = i + 1)
    {
        print_ast(list_get(&type_specifier->array_dimensions, i), file,
            depth + 2);
    }
}
